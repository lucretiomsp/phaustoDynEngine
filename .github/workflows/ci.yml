name: CI

on: [push, pull_request]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Install build tools
        run: sudo apt-get update && sudo apt-get install -y build-essential g++

      - name: Check library dependencies
        run: |
          LIB_DIR=$(pwd)/librariesBundle_Linux
          export LD_LIBRARY_PATH=$LIB_DIR:$LD_LIBRARY_PATH
          echo "🔍 Checking shared library dependencies..."
          if ldd $LIB_DIR/libdynamic-engine.so | grep "not found"; then
            echo "❌ Missing dependencies in libdynamic-engine.so"
            exit 1
          else
            echo "✅ All dependencies found"
          fi

      - name: Compile and run test program
        run: |
          LIB_DIR=$(pwd)/librariesBundle_Linux
          export LD_LIBRARY_PATH=$LIB_DIR:$LD_LIBRARY_PATH
          echo "🔧 Compiling test program..."
          g++ tests/test_dynamic_engine.cpp -L$LIB_DIR -ldynamic-engine -o test_dynamic_engine
          echo "🚀 Running test..."
          ./test_dynamic_engine
